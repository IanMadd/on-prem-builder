<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Minio Migrations</title>
<link rel="shortcut icon" type="image/png" href="/images/favicon.ico" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

  <link rel="stylesheet" href="/css/chef-sh.css" />
</head>

<body>
  <div class="off-canvas-wrapper has-sidebar">
    <div class="off-canvas-content" data-off-canvas-content>
      <div class="cell small-12">
        <nav id="utility-bar" class="utility-bar" data-toggler="active">
  <div class="grid-container">
    <div class="grid-x align-right">
      <div class="cell medium-7 utility-bar-wrapper text-right">
        <button type="button" class="utility-bar-button" data-toggle="utility-bar">
          <span class="show-for-medium">Explore the <span class="chef-logo"><span class="sr-only">Chef</span></span> Automation Portfolio</span>
          <span class="show-for-small-only">Chef Automation</span>
          <span class="arrow"><span class="sr-only">Expand</span></span>
        </button>
        <div class="utility-bar-content text-left">
          <div class="grid-x">
            <div class="oss-projects grid-x" data-equalizer>
              <div class="cell medium-4">
                <a href="https://chef.sh">
                  <div data-equalizer-watch><img src="/images/chef-logo.svg" alt="Chef" width="131" class="chef"></div>
                  <p>Ensure configurations are applied consistently in every environment, at any scale.</p>
                </a>
              </div>
              <div class="cell medium-4">
                <a href="https://inspec.io">
                  <div data-equalizer-watch><img src="/images/inspec-logo.svg" alt="Inspec" width="133" class="inspec"></div>
                  <p>Automate the validation of compliance and security in any environment, on any platform.</p>
                </a>
              </div>
              <div class="cell medium-4">
                <a href="https://habitat.sh">
                  <div data-equalizer-watch><img src="/images/habitat-logo.svg" alt="Habitat" width="111" class="habitat"></div>
                  <p>Automate the process of building, deploying, and managing any application in any environment.</p>
                </a>
              </div>
            </div>
            <div class="automate cell small-12">
              <div class="cell small-12">
                <a href="https://automate.chef.io" class="with-arrow-button">
                  <img src="/images/chef-automate-logo.svg" alt="Chef Automate" width="217" class="chef-automate">
                  <p>Build, deploy, and manage faster, more efficiently, and with less risk with Chef Automate, the continuous automation platform.</p>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

      </div>
      <div id="menu" class="cell small-12" data-sticky-container>
        

<nav data-sticky class="sticky" style="min-width:100%;" data-check-every="0" data-sticky-on="small" data-margin-top="0" data-top-anchor="utility-bar:bottom">
  <header>
    <div class="grid-container">
      <div class="grid-x">
        <div id="header-logo" class="cell large-3 small-11">
          <a href="/"><img src="/images/chef-logo.svg" alt="Chef Habitat Builder on-prem documentation"></a>
        </div>
        <div id="header-toggle" data-responsive-toggle="header-menu" data-hide-for="large" class="cell small-1">
          <div class="valign-small">
            <button type="button" data-toggle="header-menu" aria-label="Menu"><i aria-hidden="true" class="fas fa-bars fa-lg"></i></button>
          </div>
        </div>
        <div id="header-menu" class="cell large-9 small-12">
          <ul class="vertical medium-horizontal menu">
            
          </ul>
        </div>

      </div>
    </div>
  </header>
</nav>

      </div>
      <div id="main-content" class="cell small-12" data-sticky-container>
        <div class="grid-container">
          <div class="grid-x">
            <div class="cell medium-3 col-sidebar">
              


<aside class="sticky" data-sticky data-anchor="main-content-col" data-margin-top="4" data-margin-bottom="2">
  <nav id="sidebar-nav">
    
    
    <div class="nav">
      <ul class="vertical menu accordion-menu" data-accordion-menu>
        
      </ul>
    </div>
  </nav>
</aside>

            </div>
            <div id="main-content-col" class="cell medium-9 col-content">
              
<h1>Minio Migrations</h1>
<div class="prose">
  

<h1 id="migrating-package-artifacts-to-minio">Migrating Package Artifacts to Minio</h1>

<p>This section is for installations of On-Premise Depot that were done <em>prior</em> to June 15, 2018. If you re-install or upgrade to a newer version of the On-Premise Depot, you will be required to also migrate your package artifacts to a local instance of Minio (the new object store we are using). Please follow the steps below.</p>

<h2 id="pre-requisites">Pre-requisites</h2>

<ol>
<li><p>Install the following Habitat packages:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hab pkg install -b core/aws-cli
hab pkg install -b core/jq-static
hab pkg install -b habitat/s3-bulk-uploader</code></pre></div></li>
</ol>

<p>If you are running in an &ldquo;air-gapped&rdquo; environment, you may need to download the hart files and do a <code>hab pkg install -b &lt;HART FILE&gt;</code> instead.  Don&rsquo;t forget the <code>-b</code> parameter to binlink the binaries into your path.</p>

<ol>
<li>Please make sure that you have appropriate values for Minio in your <code>bldr.env</code>.  Check the &lsquo;bldr.env.sample&rsquo; for the new required values.</li>
</ol>

<h2 id="migration">Migration</h2>

<ol>
<li>Run the <code>install.sh</code> script so that Minio is appropriately configured</li>
<li>Check that you can log into your Minio instance at the URL specified in the <code>bldr.env</code></li>
<li>If all looks good, run the artifact migration script: <code>sudo ./scripts/s3migrate.sh minio</code></li>
</ol>

<p>Once the migration script starts, you will be presented with some questions to specify the Minio instance, the credentials, and the Minio bucket name to migrate your package artifacts to. The script will attempt to automatically detect all of these from the running service, so you can usually just accept the defaults. Please refer to your <code>bldr.env</code> file if you need to explicitly type in any values.</p>

<p>The migration script may take a while to move over the artifacts into Minio. During the script migration, the Depot services will continue to run as normal, however packages will not be downloadable until the artifacts are migrated over to Minio.</p>

<p>Once the migration is complete, you will be presented with an option to remove the files in your <code>hab/svc/builder-api/data/pkgs</code> directory. You may want to preserve the files until you have verified that all operations are completing successfully.</p>

</div>

            </div>
          </div>
        </div>
      </div>
      <div id="footer" class="cell small-12">
        <div class="grid-x">
          <div class="cell small-12">
            <nav>
              
<footer>
  <div class="grid-container">
    <div class="grid-x align-middle">
      <div class="cell small-12 large-3 logo"><a href="/"><img src="/images/chef-logo-light.svg" alt="Chef Habitat Builder on-prem documentation"></a></div>
      <div class="cell small-12 large-9">
        <ul class="menu vertical medium-horizontal">
          <li><a href="https://www.chef.io/online-master-agreement/" target="_blank">Licensing</a></li>
          <li><a href="https://www.chef.io/terms-of-service/" target="_blank">Terms &amp; Conditions</a></li>
          <li><a href="https://www.chef.io/trademark-policy/" target="_blank">Trademark Policy</a></li>
          <li><a href="https://www.chef.io/privacy-policy/" target="_blank">Privacy Policy</a></li>
          <li><a href="https://www.chef.io/cookie-policy/" target="_blank">Cookie Policy</a></li>
        </ul>
        <p class="legal">&copy; 2008-2019 Chef Software, Inc. All Rights Reserved.</p>
      </div>
    </div>
  </div>
</footer>

            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="/js/scripts-all.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: '3f16191e15b2b4a4b0823c9f856e2de2',
      indexName: 'chef_sh',
      inputSelector: '#doc-search',
      debug: false 
    });
  </script>
</body>
</html>
